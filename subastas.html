<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBDWQG6zKK2CDsnHASgE2jtO3DEnU2RsHw",
        authDomain: "lumers-d1d36.firebaseapp.com",
        projectId: "lumers-d1d36",
        storageBucket: "lumers-d1d36.firebasestorage.app",
        messagingSenderId: "798769127070",
        appId: "1:798769127070:web:6b591851e4c5c62758258f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // SEGURIDAD REFORZADA
    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log("Bienvenido:", user.displayName);
            document.getElementById('user').innerText = user.displayName;
            cargarSubastas(); // Solo carga si hay usuario
        } else {
            console.log("No hay usuario, esperando 3 segundos...");
            // Esperamos 3 segundos antes de echarte, por si la conexión está lenta
            setTimeout(() => {
                if (!auth.currentUser) {
                    window.location.href = "index.html";
                }
            }, 3000);
        }
    });

    function cargarSubastas() {
        // Aquí va tu código de onSnapshot que ya tenías
        onSnapshot(collection(db, "subastas"), (snap) => {
            const lista = document.getElementById('lista');
            lista.innerHTML = "";
            snap.forEach(doc => {
                const data = doc.data();
                lista.innerHTML += `<div class="bg-white p-4 rounded-xl shadow mb-2">
                    <p class="font-bold">${data.producto}</p>
                    <p class="text-sm">${data.ruta}</p>
                </div>`;
            });
        });
    }
</script>

    
